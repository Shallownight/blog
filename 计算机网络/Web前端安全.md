# Web前端安全
> 网络安全也是前端最热门的一个话题之一，作为前端开发者，有必要了解最常见的Web前端安全知识。

## 1. XSS 跨站脚本
XSS(Cross-site scripting)：提交含有JavaScript的文本让其他用户运行。

XSS输入注入攻击的一种，不攻击服务器端而攻击正常访问网站的用户。作用原理是：

在正常网站内发布评论之类的文本，里面包含JavaScript脚本，浏览器运行了这段恶意的JavaScript脚本而对用户造成伤害。  

脚本可以是一个恶作剧：
	
	while (true) {
    	alert("你关不掉我~");
	}
但也可以是更加恶劣的，比如写一段脚本，将当前页面的cookie用ajax发送到指定的cookie收集服务器上。  

浏览器的跨域限制，初衷也是为了防止XSS。但是跨域限制并不能解决问题，JSONP、iframe等都能跨域。

防止措施：
1. 将用户输入的HTML转义输出；  
2. 设置白名单，所有的标签、属性只从白名单中拿；  
3. cookie 里有个 HttpOnly 属性可以让页面无法通过 js 来读写 cookie。


## 2. CSRF 跨站请求伪造
CSRF(Cross-site Request Forgery)：借已登录用户的手来搞破坏。 

写博客的时候，在创建文章时ajax向后台发送请求的URL接口和数据、请求方式一般就行了，cookie会自动验证，不需要我们操心。然而，直接在浏览器输入URL，其实就是一种GET请求。在URL中可以包含数据，例如这个例子：

	http://example.com/bbs/create_post.php?title=我是脑残&content=哈哈
它实际上就是向http://example.com/bbs/create_post.php发送一个请求数据为{"title":"我是脑残","content":"哈哈"}的GET请求。后台收到请求后，验证你的身份，然后用你的账户创建一篇名为《我是脑残》的文章。

既然可以伪造发布文章的请求，那么转账、改密码、发邮件等请求都能伪造。

与XSS不同的是，CSRF不需要在站内输入，它不属于注入攻击。被伪造的请求可以使任何来源，而非一定是站内。只要攻击者通过QQ或者其他网站把链接发布上去，而用户点击了链接，那么就会中招。  

防止措施：  

1. **改良API**，将发布文章这类操作改为只接受POST请求（这里体现了POST的安全性），GET请求应该只支持浏览而不该改变服务器端资源。  

2. **token:令牌机制**。当客户端请求页面时，服务器会生成一个随机数Token，并且将Token放置到session当中，然后将Token发给客户。下次客户端提交请求时，Token会随着表单一起提交到服务器端。   
然后，如果应用于csrf攻击，则服务器端会对Token值进行验证，判断是否和session中的Token值相等，若相等，则可以证明请求有效，不是伪造的。 

3. **加验证码**。

4. **Referer Check**：检查如果是非正常页面过来的请求，则极有可能是CSRF攻击。 

5. **避免全站通用的cookie**。


**在CSRF攻击中，最常用的手段是令牌token机制。伪造请求中需要加上正确的{"token":token}才能伪造成功，而token是一串很难猜到的随机数。**

## 3. SQL注入
最基础的攻击方式：

	SELECT     job_id, job_desc, min_lvl, max_lvl
	FROM         jobs
	WHERE     job_id = '1' OR '1' = 1'
本来是查找某个job_id的，后面加上' OR '1' = 1就成了查找全部。

防止措施：  

1. 采用预编译语句集；（预编译：预先编译成代码文件存着，不必每次用都重编译。）
2. 使用正则表达式过滤传入的参数；
3. 屏蔽不安全的字符；

## 4. DoS和DDoS攻击
DoS(Denial of Service)：拒绝服务。目的是使计算机或网络无法提供正常的服务。  
（向受害主机发送大量看似合法的网络包，从而造成网络阻塞或服务器资源耗尽而导致拒绝服务。）

在和服务器建立TCP连接的三次握手的第二个阶段，服务器给客户端回复SYN和ASK并等待客户端回应，这个时候如果有恶意的攻击者大量模拟这种情况，就会让服务器产生数以万计的半连接，对服务器CPU和内存造成极大消耗，导致用户的正常请求失去响应。

DDoS：分布式拒绝服务，将多个计算机联合起来作为攻击平台，对一个或多个目标发动DDoS攻击，成倍提高拒绝服务攻击的威力。

防止措施：

1. 缩短SYN Timeout时间，及时将超时请求丢弃，释放被占用CPU和内存资源。

2. 限制同时打开的SYN半连接数目，关闭不必要的服务。

3. 设置SYN Cookie，给每一个请求连接的IP地址分配一个Cookie。如果短时间内连续受到某个IP的重复SYN报文，就认定是受到了攻击，以后从这个IP地址来的包会被一概丢弃。

## 5. 文件上传漏洞
网络攻击者上传了一个可执行的文件到服务器并执行。这里上传的文件可以是木马，病毒，恶意脚本或者WebShell等。攻击者在受影响系统放置或者插入WebShell后，可通过该WebShell更轻松，更隐蔽的在服务中为所欲为。

防止措施：

(1)检查服务器是否判断了上传文件类型及后缀。  

(2) 定义上传文件类型白名单，即只允许白名单里面类型的文件上传。  

(3) 文件上传目录禁止执行脚本解析，避免攻击者进行二次攻击。 


